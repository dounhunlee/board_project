<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시판</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="bg-light">

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>게시판</h2>
    <div>
        <span class="fw-bold text-primary" th:text="${name} + '님 환영합니다!'"></span>
        <a href="/logout" class="btn btn-sm btn-outline-danger ms-3">로그아웃</a>
    </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
    <!-- 내 글만 보기 체크박스 -->
    <div class="form-check form-switch m-0">
        <input class="form-check-input" type="checkbox" id="onlyMine">
        <label class="form-check-label" for="onlyMine">내 글만 보기</label>
    </div>

    <!-- 글쓰기 버튼 -->
    <a th:href="@{/posts/new}" class="btn btn-success">글쓰기</a>
</div>

<table class="table table-striped table-hover table-bordered" id="postTable">
    <thead class="table-dark text-center">
    <tr>
        <th>번호</th>
        <th>제목</th>
        <th>작성자</th>
        <th>작성일</th>
    </tr>
    </thead>
    <tbody class="text-center">
    <tr th:each="post : ${posts}"
        th:attr="data-author=${post.author}, data-title=${post.title}"
        th:onclick="|window.location.href='/posts/${post.id}'|"
    style="cursor: pointer;">
    <td th:text="${post.id}"></td>
    <td class="text-start" th:text="${post.title}"></td>
    <td th:text="${post.author}"></td>
    <td th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
    </tr>
    </tbody>
</table>


<!-- 제목 검색창 -->
<div class="mt-3 mb-5 px-3">
    <input type="text" id="titleSearch" class="form-control w-100" placeholder="제목 검색">
</div>

<!-- 내 글만 보기 + 제목 검색 -->
<script th:inline="javascript">
    const onlyMine    = document.getElementById('onlyMine');
    const titleSearch = document.getElementById('titleSearch');
    const rows        = document.querySelectorAll('#postTable tbody tr');
    const username    = /*[[${username}]]*/ '';

    function filterRows() {
        const meOnly  = onlyMine.checked;
        const keyword = titleSearch.value.toLowerCase();

        rows.forEach(tr => {
            const author = tr.getAttribute('data-author');
            const title  = tr.getAttribute('data-title').toLowerCase();

            const show = (!meOnly || author === username) && title.includes(keyword);
            tr.style.display = show ? '' : 'none';
        });
    }

    onlyMine.addEventListener('change', filterRows);
    titleSearch.addEventListener('input', filterRows);
</script>

</body>
</html>
